import { useState } from "react";
import { initializeApp } from "firebase/app";
import { getFirestore, collection, query, where, getDocs } from "firebase/firestore";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

export default function CompanySearch() {
  const [search, setSearch] = useState("");
  const [suggestions, setSuggestions] = useState([]);
  const [selectedCompany, setSelectedCompany] = useState(null);

  const handleSearch = async (value) => {
    setSearch(value);
    if (value.length < 2) {
      setSuggestions([]);
      return;
    }

    try {
      const q = query(
        collection(db, "companies"),
        where("name", ">=", value),
        where("name", "<=", value + "\uf8ff")
      );
      const querySnapshot = await getDocs(q);

      const results = [];
      querySnapshot.forEach((doc) => {
        results.push({ id: doc.id, ...doc.data() });
      });

      setSuggestions(results);
    } catch (error) {
      console.error("Error fetching companies: ", error);
      setSuggestions([]);
    }
  };

  const handleSelect = (company) => {
    setSelectedCompany(company);
    setSearch(company.name);
    setSuggestions([]);
  };

  return (
    <div>
      <h1>会社検索</h1>
      <input
        type="text"
        value={search}
        onChange={(e) => handleSearch(e.target.value)}
        placeholder="会社名を入力..."
        style={{ padding: "8px", width: "300px", marginBottom: "10px" }}
      />
      {suggestions.length > 0 && (
        <ul style={{ listStyleType: "none", padding: 0 }}>
          {suggestions.map((company) => (
            <li
              key={company.id}
              onClick={() => handleSelect(company)}
              style={{ cursor: "pointer", padding: "5px", borderBottom: "1px solid #ccc" }}
            >
              {company.name}
            </li>
          ))}
        </ul>
      )}

      {selectedCompany && (
        <div style={{ marginTop: "20px" }}>
          <h2>選択した会社</h2>
          <p><strong>会社名:</strong> {selectedCompany.name}</p>
          <p><strong>住所:</strong> {selectedCompany.address}</p>
        </div>
      )}
    </div>
  );
}
